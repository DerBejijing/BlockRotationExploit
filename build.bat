@echo off

REM	IMPORTANT!!
REM	This file is junk, it copies more files than needed but I will not put any more effort into this, since I dont want to waste my time coding for a crappy OS.

set SRCDIR=src
set JARFILE=CoordinateCracker_v5
set MAIN=io.github.derbejijing.coordinatecracker.Main

set MAINPATH=%MAIN:.=\%
set MAINPATH=%MAINPATH%.class

set NEXTFILE=none

cd %SRCDIR%

dir /s /B *.java > sources.txt

color 06
cls
echo Compiling ...
javac @sources.txt

cls
echo Building jar file ...
jar -cfe %JARFILE%_tmp.jar %MAIN% %MAINPATH%


echo ... Classes ...
REM dir /s /B *.class > sources.txt
for /f %%A in ('forfiles /s /m *.class /c "cmd /c echo @relpath"') do echo %%~A >> sources.txt
for /F "tokens=*" %%A in  (sources.txt) do (
jar -uf %JARFILE%_tmp.jar %%A
)


cls
echo Building jar file ...
echo ... Images ...
REM dir /s /B *.png > sources.txt
for /f %%A in ('forfiles /s /m *.png /c "cmd /c echo @relpath"') do echo %%~A >> sources.txt
for /F "tokens=*" %%A in  (sources.txt) do (
jar -uf %JARFILE%_tmp.jar %%A 
)

cls
echo Cleaning ...
del /q sources.txt
del /q /s *.class
move %JARFILE%_tmp.jar ../%JARFILE%.jar

cls
color 02
echo Done!
echo And copied everything twice because windows-batch is bullshit!
pause
cd ../
color 0F
cls
